@{
    ViewData["Title"] = "Loading Animation";
    Layout = null; // Or use your layout
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(to bottom right, 
                oklch(0.381 0.176 304.987), 
                oklch(0.379 0.146 265.522), 
                oklch(0.359 0.144 278.697));
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-family: ui-sans-serif, system-ui, sans-serif;
        }

        .container {
            position: relative;
        }

        .vinyl-stack-container {
            position: relative;
            height: 128px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vinyl-stack {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0;
        }

        .vinyl-item {
            position: absolute;
            width: 112px;
            height: 112px;
        }

        .vinyl-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .vinyl-item.entering {
            animation: slideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @@keyframes slideIn {
            from {
                transform: translateX(-100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .box-container {
            display: flex;
            justify-content: center;
            position: relative;
            margin-left: 140px;
        }

        .box-container img {
            width: 128px;
            height: 128px;
            object-fit: contain;
        }

        .dropping-vinyl {
            position: absolute;
            top: 0;
            left: 50%;
            width: 112px;
            height: 112px;
            z-index: 50;
            animation: dropVinyl 0.8s ease-in forwards;
        }

        .dropping-vinyl img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @@keyframes dropVinyl {
            0% {
                transform: translate(-36px, -180px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-36px, 80px) rotate(180deg);
                opacity: 0;
            }
        }

        .loading-text-container {
            margin-top: 32px;
            text-align: center;
            margin-left: 140px;
        }

        .loading-text {
            color: white;
            font-size: 1.25rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @@keyframes pulse {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Stack of vinyls -->
        <div class="vinyl-stack-container">
            <div class="vinyl-stack" id="vinylStack">
                <!-- Vinyl items will be dynamically added here -->
            </div>
        </div>

        <!-- Box -->
        <div class="box-container">
            <img src="~/images/Crate2.png" alt="Box" />
            <!-- Dropping vinyl will be dynamically added here -->
        </div>

        <!-- Loading text -->
        <div class="loading-text-container">
            <p class="loading-text">Loading...</p>
        </div>
    </div>

    <script>
        (function() {
            const vinylImagePath = '@Url.Content("~/images/Vinyl cover for load image.png")';
            const vinylStack = document.getElementById('vinylStack');
            const boxContainer = document.querySelector('.box-container');
            
            let vinyls = [
                { id: 0, status: 'stack' },
                { id: 1, status: 'stack' },
                { id: 2, status: 'stack' },
                { id: 3, status: 'stack' },
                { id: 4, status: 'stack' },
                { id: 5, status: 'stack' },
                { id: 6, status: 'stack' },
                { id: 7, status: 'stack' },
                { id: 8, status: 'stack' },
                { id: 9, status: 'stack' }
            ];
            
            let nextId = 10;
            let currentlyDropping = false;

            function renderVinyls() {
                const stackVinyls = vinyls.filter(v => v.status === 'stack');
                vinylStack.innerHTML = '';
                
                stackVinyls.forEach((vinyl, index) => {
                    const vinylElement = document.createElement('div');
                    vinylElement.className = 'vinyl-item entering';
                    vinylElement.setAttribute('data-id', vinyl.id);
                    
                    const brightness = 0.7 + index * 0.03;
                    vinylElement.style.left = `${index * 20}px`;
                    vinylElement.style.zIndex = index;
                    vinylElement.style.filter = `brightness(${brightness})`;
                    
                    const img = document.createElement('img');
                    img.src = vinylImagePath;
                    img.alt = 'Vinyl';
                    
                    vinylElement.appendChild(img);
                    vinylStack.appendChild(vinylElement);
                });
            }

            function dropVinyl() {
                if (currentlyDropping) return;
                
                currentlyDropping = true;
                
                // Mark the last vinyl as dropping
                const lastIndex = vinyls.length - 1;
                if (vinyls[lastIndex]) {
                    vinyls[lastIndex].status = 'dropping';
                    
                    // Create dropping vinyl element
                    const droppingElement = document.createElement('div');
                    droppingElement.className = 'dropping-vinyl';
                    droppingElement.setAttribute('data-id', vinyls[lastIndex].id);
                    
                    const img = document.createElement('img');
                    img.src = vinylImagePath;
                    img.alt = 'Dropping Vinyl';
                    
                    droppingElement.appendChild(img);
                    boxContainer.appendChild(droppingElement);
                    
                    // After drop animation completes
                    setTimeout(() => {
                        // Remove the dropped vinyl and add a new one at the beginning
                        vinyls = vinyls.slice(0, -1);
                        vinyls.unshift({ id: nextId, status: 'stack' });
                        nextId++;
                        
                        // Remove dropping element
                        droppingElement.remove();
                        
                        // Re-render stack
                        renderVinyls();
                        
                        currentlyDropping = false;
                    }, 800);
                }
            }

            function startAnimation() {
                const timer = setTimeout(() => {
                    dropVinyl();
                }, 1200);
                
                return timer;
            }

            // Initial render
            renderVinyls();
            
            // Start the animation loop
            function animationLoop() {
                const timer = startAnimation();
                
                setTimeout(() => {
                    clearTimeout(timer);
                    if (!currentlyDropping) {
                        animationLoop();
                    } else {
                        // Wait for drop to complete, then continue loop
                        setTimeout(() => {
                            animationLoop();
                        }, 800);
                    }
                }, 1200);
            }
            
            // Start the loop
            animationLoop();
        })();
    </script>
</body>
</html>